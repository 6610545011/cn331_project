{% extends "core/template.html" %}
{% load static %}

{% block title %}{{ prof.prof_name }} - Thammasat Study Plan{% endblock title %} {# <--- แก้ไข .name เป็น .prof_name #}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'core/css/detail_page.css' %}">
{% endblock extra_head %}

{% block content %}
<div class="detail-container">
    
    <div class="detail-header">
        <div class="header-content">
            {% if prof.imgurl %} {# <--- แก้ไข .img_url เป็น .imgurl #}
                <img src="{{ prof.imgurl }}" alt="Photo of {{ prof.prof_name }}" class="profile-image"> {# <--- แก้ไข .img_url เป็น .imgurl #}
            {% endif %}
            <div class="header-text">
                <h1>{{ prof.prof_name }}</h1> {# <--- แก้ไข .name เป็น .prof_name #}
                
                {# ส่วนนี้อาจต้องปรับตาม model ของคุณ ถ้าไม่มี campus, room ใน Prof model โดยตรง #}
                {# <p class="sub-heading">
                    <strong>Campus:</strong> {{ prof.campus.name }} | 
                    <strong>Room:</strong> {{ prof.room.name }}
                </p> #}

                {% if prof.email %}
                    <p><strong>Email:</strong> <a href="mailto:{{ prof.email }}">{{ prof.email }}</a></p>
                {% endif %}
                <p>{{ prof.description }}</p>
            </div>
        </div>
    </div>

    <div class="detail-content">
        <h3>Sections Taught</h3>
        <div class="card-list">
            {% for section in prof.teaching_sections.all %}
                <div class="info-card">
                    <h4><a href="{% url 'core:course_detail' pk=section.course.pk %}">{{ section.course.course_code }} - {{ section.course.course_name }}</a></h4>
                    <p>
                        <strong>Section:</strong> {{ section.section_number }}
                        {% if section.campus %}| <strong>Campus:</strong> {{ section.campus.name }}{% endif %}
                    </p>
                </div>
            {% empty %}
                <p>This professor is not currently assigned to any sections.</p>
            {% endfor %}
        </div>
    </div>

    <div class="detail-content">
        <h3>Reviews</h3>
        <div class="card-list">
            {# โค้ดส่วนนี้ถูกต้องแล้ว เพราะ view ส่ง 'reviews' มาให้ #}
            {% for review in reviews %}
                {% include "review/includes/review_block.html" with review=review %}
            {% empty %}
                <p>No reviews for this professor yet. Be the first to write one!</p>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock content %}

{% block extra_scripts %}
    {# The review actions script is now loaded globally in main.js #}
{% endblock extra_scripts %}